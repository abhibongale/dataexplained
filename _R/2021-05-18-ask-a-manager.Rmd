---
layout: post
title: "Survivor TV Show data"
description: "data sets detailing events across all 40 seasons of the US Survivor, including castaway information, vote history, immunity and reward challenge winners and jury votes."
output: html_document
date: "`r Sys.Date()`"
category: r
tags: [r, tidytuesday, tidyverse]
comments: true
editor_options: 
  chunk_output_type: console
---

![ask-a-manager](https://www.askamanager.org/wp-content/uploads/2019/09/cropped-aam-resize-1-550px_width.png)



```{r echo=FALSE}
library(tidyverse)
library(tidymodels)
```


```{r}
survey_raw <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-18/survey.csv')
```


```{r}
survey  <- survey_raw %>%
  filter(gender == "Woman", annual_salary >= 5000, annual_salary <= 2e6, currency == "USD") %>%
  mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
         age_category = fct_relevel(age_category,"under 18"),
         overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience, 
                                                     " - ", "-"),
                                        parse_number(overall_years_of_professional_experience)),
         field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
                                        parse_number(years_of_experience_in_field)),
         education = factor(highest_level_of_education_completed)
         ) %>%
  select(-c(how_old_are_you, 
            years_of_experience_in_field, 
            overall_years_of_professional_experience,
            timestamp, job_title, additional_context_on_income, 
            additional_context_on_job_title, currency, other_monetary_comp, currency_other,
            country, race, gender, highest_level_of_education_completed))
```


```{r}  
survey %>%
  filter(!is.na(industry)) %>%
  mutate(industry = fct_lump(industry, 8)) %>%
  lm(annual_salary ~ industry, data = .) %>%
  summary()
```

```{r}
survey %>%
  filter(annual_salary > 5000, annual_salary <= 2e6) %>%
  ggplot(aes(log2(annual_salary))) +
  geom_histogram(aes(fill = overall_experience)) +
  scale_x_continuous(label = scales::dollar_format())  +
  facet_wrap(~field_experience)
```

```{r}
survey %>%
  filter(!is.na(industry)) %>%
  mutate(industry = fct_lump(industry, 8),
         state = fct_lump(state, 8)) %>%
  glm(annual_salary ~ industry + field_experience + overall_experience + age_category + state, 
     data = .) %>%
  summary()
```


```{r}
survey_split <- initial_split(survey)
survey_train <- training(survey_split)
survey_test <- testing(survey_split)
```


```{r}
survey_recipe <- survey %>%
  recipe(annual_salary ~ .) %>%
  step_log(annual_salary) %>%
  step_unknown(all_nominal()) %>%
  step_other(all_nominal()) %>%
  step_dummy(all_nominal()) %>%
  prep()


survey_train_prep <- bake(survey_recipe, survey_train)
survey_test_prep <- bake(survey_recipe, survey_test)
```


```{r}
lin_reg <- linear_reg(penalty = 0.1, mode = "regression") %>%
  set_engine("lm") 



```


```{r}
lin_workflow <- # new workflow object
 workflow() %>% # use workflow function
 add_recipe(survey_recipe) %>%   # use the new recipe
 add_model(lin_reg)   # add your model spec
```

```{r}


lin_fit <- lin_workflow %>%
  last_fit(survey_split)
```

```{r}
lin_prediction <- lin_fit %>%
  collect_predictions()

lin_performance <- lin_fit %>%
  collect_metrics(summarize = TRUE)
```

```{r}
lin_fit %>%
  collect_metrics()
```

