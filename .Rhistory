arrange(desc(non_health_dismiss)) %>%
ggplot(aes(non_health_dismiss, n)) +
geom_area()
departures %>%
select(notes, ratio_dismissal) %>%
unnest_tokens(word, notes) %>%
anti_join(stop_words, by = "word") %>%
count(word) %>%
arrange(desc(n)) %>%
filter(n > 100) %>%
with(wordcloud(word, n, max.words = 200))
notes_sentiment %>%
group_by(departure_code) %>%
summarise(sentiment_code = sum(senti_value)) %>%
filter(!is.na(departure_code)) %>%
ggplot(aes(departure_code, sentiment_code)) +
geom_col()
new_departure <- SMOTE(smote_departures, smote_departures$ceo_dismissal, K = 10)
library(smotefamily)
smote_departures <- smote_departures %>%
inner_join(notes_sentiment, by = c("exec_fullname","departure_code")) %>%
select(fyear, departure_code, ceo_dismissal, tenure_no_ceodb, max_tenure_ceodb, total_dismiss, ratio_dismissal, senti_value)
new_departure <- SMOTE(smote_departures, smote_departures$ceo_dismissal, K = 10)
smote_departures <- departures %>%
inner_join(notes_sentiment, by = c("exec_fullname","departure_code")) %>%
select(fyear, departure_code, ceo_dismissal, tenure_no_ceodb, max_tenure_ceodb, total_dismiss, ratio_dismissal, senti_value)
new_departure <- SMOTE(smote_departures, smote_departures$ceo_dismissal, K = 10)
View(smote_departures)
new_departure <- SMOTE(smote_departures, smote_departures$ceo_dismissal, K = 10)
View(notes_sentiment)
smote_departures <- departures %>%
inner_join(notes_sentiment, by = c("exec_fullname","departure_code")) %>%
select(fyear, departure_code, ceo_dismissal, tenure_no_ceodb, max_tenure_ceodb, total_dismiss, ratio_dismissal, senti_value) %>%
filter(!is.na(ceo_dismissal))
new_departure <- SMOTE(smote_departures, smote_departures$ceo_dismissal, K = 10)
View(smote_departures)
View(new_departure)
new_departure$data %>%
count(ceo_dismissal)
new_departure$syn_data %>%
count(ceo_dismissal)
new_departure$data
new_departure$data %>%
co.intervals()
new_dataset <- new_departure$data
View(new_dataset)
new_dataset %>%
count(n)
new_dataset %>%
count(ceo_dismissal)
new_dataset %>%
mutate(count(ceo_dismissal))
new_dataset %>%
mutate(total_count = n(ceo_dismissal))
new_dataset %>%
count(total_count = n(ceo_dismissal))
new_dataset %>%
count(year, ceo_dismissal)
new_dataset %>%
count(year, ceo_dismissal)
new_dataset %>%
count(fyear, ceo_dismissal)
library(lubridate)
new_dataset %>%
count(year(fyear), ceo_dismissal)
View(new_dataset)
new_dataset %>%
mutate(fyear = year(fyear))
new_dataset %>%
mutate(fyear = as.Date(fyear))
new_dataset %>%
mutate(fyear = as.Date(as.character(fyear), format = "%Y"))
new_dataset %>%
mutate(fyear = as.Date(as.character(fyear), format = "%Y"),
fyear = year(fyear))
new_dataset <- new_dataset %>%
mutate(fyear = as.Date(as.character(fyear), format = "%Y"),
fyear = year(fyear))
View(smote_departures)
new_dataset %>%
count(fyear, ceo_dismissal)
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) %>%
geom_line(aes(fill = ceo_dismissal))
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(fill = ceo_dismissal))
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal))
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal))
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
departures %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
departures %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, factor(ceo_dismissal)) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
departures %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, factor(ceo_dismissal)) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
new_dataset %>%
count(fyear, factor(ceo_dismissal)) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
new_dataset <- new_dataset %>%
mutate(fyear = as.Date(as.character(fyear), format = "%Y"),
fyear = year(fyear), ceo_dismissal = factor(ceo_dismissal))
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
departures %>%
mutate(ceo_dismissal = factor(ceo_dismissal)) %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point()
cor(new_dataset)
departures %>%
mutate(ceo_dismissal = factor(ceo_dismissal)) %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
departures %>%
filter(fyear < 2020) %>%
mutate(ceo_dismissal = factor(ceo_dismissal)) %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
departures %>%
filter(fyear < 2019) %>%
mutate(ceo_dismissal = factor(ceo_dismissal)) %>%
filter(!is.na(ceo_dismissal)) %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
new_dataset %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
new_dataset %>%
filter(fyear < 2019) %>%
count(fyear, ceo_dismissal) %>%
ggplot(aes(fyear, n)) +
geom_line(aes(color = ceo_dismissal)) +
geom_point() +
geom_smooth()
new_dataset %>%
glm.fit = glm(ceo_dimissmal ~ .)
new_dataset %>%
glm.fit = glm(ceo_dimissmal ~ fyear+departure_code + tenure_no_ceodb:senti_value)
new_dataset %>%
glm(ceo_dimissmal ~ fyear+departure_code + tenure_no_ceodb:senti_value)
new_dataset %>%
glm(ceo_dimissmal ~ fyear+departure_code + tenure_no_ceodb:senti_value, family = binomial)
new_dataset %>%
glm(ceo_dimissmal ~ fyear+departure_code + tenure_no_ceodb:senti_value,
family = binomial)
glm(ceo_dimissmal ~ fyear+departure_code + tenure_no_ceodb:senti_value, data = new_dataset, family = binomial)
glm(ceo_dismissal ~ fyear+departure_code + tenure_no_ceodb:senti_value, data = new_dataset, family = binomial)
glm(ceo_dismissal ~ ., data = new_dataset, family = binomial)
glm.fit = glm(ceo_dismissal ~ ., data = new_dataset, family = binomial)
summary(glm.fit)
glm.fit = glm(ceo_dismissal ~ departure_code, data = new_dataset, family = binomial)
summary(glm.fit)
glm.fit = glm(ceo_dismissal ~ departure_code+senti_value, data = new_dataset, family = binomial)
summary(glm.fit)
glm.fit = glm(ceo_dismissal ~ departure_code+ fyear, data = new_dataset, family = binomial)
summary(glm.fit)
glm.fit = glm(ceo_dismissal ~ departure_code+ratio_dismissal, data = new_dataset, family = binomial)
summary(glm.fit)
glm.fit = glm(ceo_dismissal ~ departure_code+senti_value, data = new_dataset, family = binomial)
glm.fit = glm(ceo_dismissal ~ departure_code+senti_value, data = new_dataset, family = binomial)
summary(glm.fit)
library(tidyverse)
library(tidymodels)
survey_raw <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-18/survey.csv')
survey  <- survey_raw %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience)) %>%
count(overall_experience)
View(survey)
survey  <- survey_raw %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience))
View(survey)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(log2(annual_salary) ~ overall_experience, data = survey)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(log2(annual_salary) ~ overall_experience, data = .)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(log2(annual_salary) ~ overall_experience + job_title, data = .)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(log2(annual_salary) ~ overall_experience + job_title, data = survey)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(log2(annual_salary) ~ overall_experience + job_title, data = .)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .)
survey %>%
mutate(job_title = fct_lump(job_title, 8)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .) %>%
summary()
survey %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .) %>%
summary()
survey %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .) %>%
summary()
survey %>%
mutate(industry = fct_lump(industry, 10)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .) %>%
summary()
survey %>%
mutate(industry = fct_lump(industry, 10)) %>%
lm(annual_salary ~ overall_experience + job_title, data = .) %>%
summary()
library(tidyverse)
library(tidymodels)
survey_raw <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-05-18/survey.csv')
survey  <- survey_raw %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience))
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ industry, data = .) %>%
summary()
View(survey)
survey %>%
filter(annual_salary > 5000, annual_salary <= 2e6) %>%
ggplot(aes(log2(annual_salary))) +
geom_histogram(aes(fill = overall_experience)) +
scale_x_continuous(label = scales::dollar_format())  +
facet_wrap(~field_experience)
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ industry, data = .) %>%
summary()
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ industry + field_experience + overall_experience, data = .) %>%
summary()
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
lm(annual_salary ~ industry + field_experience + overall_experience + age_category,
data = .) %>%
summary()
survey
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
glm(annual_salary ~ industry + field_experience + overall_experience + age_category,
data = .) %>%
summary()
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
glm(annual_salary ~ I(industry,2) + field_experience + overall_experience + age_category,
data = .) %>%
summary()
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
glm(annual_salary ~ industry + field_experience + overall_experience + age_category,
data = .) %>%
summary()
View(survey_raw)
survey  <- survey_raw %>%
filter(gender == "Woman", annual_salary >= 5000, annual_salary <= 2e6, currency = "USD") %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience,
timestamp, job_title, additional_context_on_income,
additional_context_on_job_title, currency, other_monetary_comp, currency_other,
country, race))
survey  <- survey_raw %>%
filter(gender == "Woman", annual_salary >= 5000, annual_salary <= 2e6, currency == "USD") %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience,
timestamp, job_title, additional_context_on_income,
additional_context_on_job_title, currency, other_monetary_comp, currency_other,
country, race))
survey  <- survey_raw %>%
filter(gender == "Woman", annual_salary >= 5000, annual_salary <= 2e6, currency == "USD") %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field))
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience,
timestamp, job_title, additional_context_on_income,
additional_context_on_job_title, currency, other_monetary_comp, currency_other,
country, race, gender))
View(survey)
survey  <- survey_raw %>%
filter(gender == "Woman", annual_salary >= 5000, annual_salary <= 2e6, currency == "USD") %>%
mutate(age_category = fct_reorder(how_old_are_you, parse_number(how_old_are_you)),
age_category = fct_relevel(age_category,"under 18"),
overall_experience = fct_reorder(str_replace(overall_years_of_professional_experience,
" - ", "-"),
parse_number(overall_years_of_professional_experience)),
field_experience = fct_reorder(str_replace(years_of_experience_in_field, " - ", "-"),
parse_number(years_of_experience_in_field)),
education = factor(highest_level_of_education_completed)
) %>%
select(-c(how_old_are_you,
years_of_experience_in_field,
overall_years_of_professional_experience,
timestamp, job_title, additional_context_on_income,
additional_context_on_job_title, currency, other_monetary_comp, currency_other,
country, race, gender, highest_level_of_education_completed))
View(survey)
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8)) %>%
glm(annual_salary ~ industry + field_experience + overall_experience + age_category,
data = .) %>%
summary()
survey_split <- initial_split(survey)
survey_train <- training(survey_split)
survey_test <- testing(survey_split)
View(survey_train)
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8),
state = fct_lump(state, 8)) %>%
glm(annual_salary ~ industry + field_experience + overall_experience + age_category,
data = .) %>%
summary()
survey %>%
filter(!is.na(industry)) %>%
mutate(industry = fct_lump(industry, 8),
state = fct_lump(state, 8)) %>%
glm(annual_salary ~ industry + field_experience + overall_experience + age_category + state,
data = .) %>%
summary()
survey_prep <- bake(survey_prep, survey_train)
survey_prep <- bake(survey_recipe, survey_train)
survey_recipe <- survey %>%
recipe(annual_salary ~ .) %>%
step_log(annual_salary) %>%
step_unknown(all_nominal()) %>%
step_other(all_nominal()) %>%
step_dummy(all_nominal()) %>%
prep()
survey_prep <- bake(survey_recipe, survey_train)
survey_test_prep <- bake(survey_recipe, survey_test)
survey_train_prep <- bake(survey_recipe, survey_train)
View(survey_train)
View(survey_train_prep)
linear_reg(mode = "regression") %>%
set_engine("lm") %>%
fit(survey_train_prep)
linear_reg(mode = "regression") %>%
set_engine("lm") %>%
fit(data = survey_train_prep)
linear_reg(mode = "regression") %>%
set_engine("lm") %>%
fit(annual_salary ~ ., data = survey_train_prep)
install.packages(c("kknn", "xgboost", "ranger"))
lin_reg <- linear_reg(mode = "regression") %>%
set_engine("lm")
lin_workflow <- # new workflow object
workflow() %>% # use workflow function
add_recipe(survey_recipe) %>%   # use the new recipe
add_model(lin_spec)   # add your model spec
lin_workflow <- # new workflow object
workflow() %>% # use workflow function
add_recipe(survey_recipe) %>%   # use the new recipe
add_model(lin_reg)   # add your model spec
lin_fit <- lin_workflow %>%
last_fit(survey_split)
lin_prediction <- lin_fit %>%
collect_predictions()
View(lin_prediction)
lin_performance <- lin_fit %>%
collect_metrics()
View(lin_performance)
View(lin_prediction)
lin_performance <- lin_fit %>%
collect_metrics()
lin_performance <- lin_fit %>%
collect_metrics(summarize = TRUE)
View(lin_performance)
lin_fit %>%
collect_metrics()
lin_fit %>%
collect_metrics(summarize = TRUE)
lin_fit %>%
collect_predictions()
lin_reg <- linear_reg(penalty = 0.1, mode = "regression") %>%
set_engine("lm")
lin_workflow <- # new workflow object
workflow() %>% # use workflow function
add_recipe(survey_recipe) %>%   # use the new recipe
add_model(lin_reg)   # add your model spec
lin_fit <- lin_workflow %>%
last_fit(survey_split)
lin_prediction <- lin_fit %>%
collect_predictions()
lin_performance <- lin_fit %>%
collect_metrics(summarize = TRUE)
lin_fit %>%
collect_metrics()
